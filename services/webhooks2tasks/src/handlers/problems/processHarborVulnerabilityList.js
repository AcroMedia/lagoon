// @flow

const { logger } = require('@lagoon/commons/src/local-logging');
const { addProblem } = require('@lagoon/commons/src/api');

async function processHarborVulnerabilityList(webhook: WebhookRequestData, channelWrapperWebhooks) {
  const {
    webhooktype,
    event,
    uuid,
    body
  } = webhook;

        for(const objKey in webhook.body) {
          if(webhook.body[objKey].vulnerabilities) {
            let vulnerabilities = webhook.body[objKey].vulnerabilities;
            //Should we test these objects against some kind of type? Can we?
            vulnerabilities.forEach(element => {
              //console.log(element.description);
              //TODO: convert trivy severity to our levels
              //TODO:
              try {
                // addAProblem(null, 1, element.id, 'HIGH', 'harbor', null, JSON.stringify({description: element.description, links: element.links}));
                console.log(element);
              }
             catch (error) {
                console.log(error);
             }
            });
          }
      }
}

module.exports = processHarborVulnerabilityList;